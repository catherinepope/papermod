{{ $subjects := slice }}
{{ range $key, $book := .Site.Data.books }}
  {{ range $book.subject }}
    {{ $subjects = $subjects | append . }}
  {{ end }}
{{ end }}
{{ $subjects = $subjects | uniq | sort }}

{{ range $subjects }}
  {{ $currentSubject := . }}
  <h2>{{ . }}</h2>
  <ul class="book-list">
  {{ range $key, $book := $.Site.Data.books }}
    {{ if in $book.subject $currentSubject }}
      <li>{{ partial "book-link.html" $book }}</li>
    {{ end }}
  {{ end }}
  </ul>
{{ end }}